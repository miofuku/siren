{% extends 'frontend/base.html' %}

{% block extra_head %}
<style>
    #map {
        height: 400px;
        width: 100%;
    }
</style>
{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-md p-6">
    <h1 class="text-3xl font-bold mb-4">{{ post.title }}</h1>

    <p class="mb-4">{{ post.content }}</p>

    <p class="text-sm text-gray-600"><strong>Type:</strong> {{ post.type }}</p>
    <p class="text-sm text-gray-600 mb-4"><strong>Posted on:</strong> {{ post.created_at|date:"F d, Y" }}</p>

    <h2 class="text-xl font-semibold mb-2">Locations:</h2>
    <ul class="mb-4">
        {% for location in post.locations %}
        <li>{{ location.name }}</li>
        {% endfor %}
    </ul>

    <div id="map" class="mb-4"></div>

    <a href="{% url 'post_list' %}" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Back to Posts</a>
</div>
{% endblock %}

{% block extra_body %}
<script>
function initMap() {
    const bounds = new google.maps.LatLngBounds();
    const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 10,
    });

    const locations = [
        {% for location in post.locations %}
        {
            name: "{{ location.name }}",
            lat: {{ location.coordinates.1 }},
            lng: {{ location.coordinates.0 }}
        },
        {% endfor %}
    ];

    locations.forEach(function(loc) {
        const position = { lat: loc.lat, lng: loc.lng };
        const marker = new google.maps.Marker({
            position: position,
            map: map,
            title: loc.name
        });
        bounds.extend(position);
    });

    map.fitBounds(bounds);
}

function loadGoogleMaps() {
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap`;
    script.async = true;
    script.defer = true;
    document.head.appendChild(script);
}

if (window.google && window.google.maps) {
    initMap();
} else {
    window.addEventListener('load', loadGoogleMaps);
}
</script>
{% endblock %}